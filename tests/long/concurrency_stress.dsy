module concurrency_stress_test

import stdlib_concurrency

fn worker(ch: channel) -> int:
  set _ = stdlib_concurrency.send_many(ch, 100, 0)
  return 0

fn main() -> int:
  set ch = stdlib_concurrency.new_channel()
  set _ = spawn(worker, ch)
  set _ = spawn(worker, ch)
  set _ = spawn(worker, ch)
  set _ = spawn(worker, ch)
  set total = stdlib_concurrency.recv_sum(ch, 400)
  print total
  set _ = stdlib_concurrency.close(ch)
  return 0

